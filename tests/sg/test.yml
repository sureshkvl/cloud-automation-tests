---
- name: "testing"
  gather_facts: false
  hosts: sg_vm1
  tasks:

  - name: ping the sg vm2 server
    shell: "ping -c 5 {{sg_vm2_ip}} "
    ignore_errors: true
    register: ping_result

  - name: print the ping result     
    debug: var=ping_result

  - debug:
    msg: "{{ ping_result.stdout_lines[-1] | regex_search('(100% packet loss)') }}"

  - name: update the security group to block ping
    delegate_to: localhost
    shell: |
      openstack port set --no-security-group port_1
    register: task_result

  - debug:
      var: task_result


  - name: ping the sg vm2 server
    shell: "ping -c 5 {{sg_vm2_ip}} "
    ignore_errors: true
    register: ping_result

  - name: print the ping result     
    debug: var=ping_result
    


#  - name: validate the ping result     
#    fail: 
#      msg: "Failed response is not correct"
#    when: ping_result.stdout contains 