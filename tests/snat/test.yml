---
- name: "Security Group Test"
  gather_facts: false
  hosts: sg_vm2

  tasks:
  - name: Ping the Backend VM
    shell: "ping -c 10 8.8.8.8 "
    ignore_errors: true
    register: ping_result

  - name: Ping Result     
    debug: var=ping_result

  - set_fact: example_var={{ ping_result.stdout | regex_search('(, 0% packet loss)') }}

  - set_fact: result=Passed
    when: example_var != ""

  - set_fact: result=Failed
    when: example_var == ""

  - name: Printing the Test Result
    debug:
      msg: 
        - "***********************************************"
        - "                                               "
        - "     Test Result :   {{ result }}              "
        - "                                               "
        - "***********************************************"

  #- name: Exit with failure message
  #  fail: 
  #    msg: "After removing SG,it Pings... FAILURE"
  #  when: example1_var == ""
